trigger:
  - main

stages:
  - stage: Build
    jobs:
      - job: BuildAndDeploy
        steps:
          - task: NodeTool@0
            inputs:
              versionSpec: "16.x"
            displayName: "Install Node.js"
          - script: |
              echo "changing dir to frontend......."
              cd wallet-watch-frontend
              echp "installing packages for frontend..."
              npm install
              ng build --configuration=production --output-path=../wallet-watch-backend/public
            displayName: "Build Frontend"

          - script: |
              mkdir -p wallet-watch-backend/public
              cp -r wallet-watch-frontend/dist/* wallet-watch-backend/
            displayName: "Copy Frontend Build to Backend"

          - script: |
              cd wallet-watch-backend
              npm install
            displayName: "Install Backend Dependencies"

          - task: AzureWebApp@1
            inputs:
              azureSubscription: "WalletWatch"
              appName: "WalletWatch"
              package: "wallet-watch-backend"
